define(["jquery","jquery.ajax_load","jquery.ui","jquery.msg","blockui","datatables","principal_list_dataTables","bootstrap"],function(b){var c=function a(){this.vars={idBtnConsulta:null,idBtnExcluir:null,idTooltipMessage:null,idTabela:null,idOpcoesConsulta:null,idLabelBusca:null,idHeadCheckTable:null,aoColumns:[],idMsgExcluir:"#msgExcluir",idTdCheckTable:"tblTdCheck",constCodigos:"codigos",urlBuscarRegistros:null,urlExcluirRegistros:null,contentMsgExcluir:"<div class='modal fade' id='msgExcluir' tabindex='-1'role='dialog' aria-labelledby='msgExcluirLabel' aria-hidden='true' style='display:none'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button><h4 class='modal-title' id='msgExcluirLabel'> Mensagem de AdvertÃªncia </h4></div><div class='modal-body'>Remover registros selecionados?</div><div class='modal-footer'><button type='button' class='btn btn-primary' data-dismiss='modal'> Confirmar </button><button type='button' class='btn btn-default' data-dismiss='modal'> Cancelar </button></div></div></div></div>"};this.alterarOpcoesConsulta=null;this.mostrarLabelBusca=null;this.getOpcoesConsulta=null;this.onsubmit=function(d){var e=this;b(d).eq(0).submit(function(f){b(e.vars.idTabela).dataTable().fnDraw();f.preventDefault()})}};c.prototype={popularTabela:null,getCheckbox_Checked:function(){return b("input:checkbox:checked[name="+this.vars.idTdCheckTable+"]").parent()},getTdCheck:function(d){var g=this,e=b(document.createElement("td")),h=b(document.createElement("input")),f=b(document.createElement("input"));h.attr("type","hidden");h.val(d);f.attr("name",g.vars.idTdCheckTable);f.attr("type","checkbox");f.click(function(i){if(this.checked){if(b("input[name="+g.vars.idTdCheckTable+"]:checked").length==b("input[name="+g.vars.idTdCheckTable+"]").length){b(g.vars.idHeadCheckTable).attr("checked",true)}}else{if(b(g.vars.idHeadCheckTable).attr("checked")){b(g.vars.idHeadCheckTable).attr("checked",false)}}});e.append(h);e.append(f);return e},formatarColunaClick:function(f,e){var d=b(document.createElement("a")),g=b(document.createElement("td"));d.attr("href",f);d.html(b().htmlentities(e));d.html(e);g.append(d);return g},acaoExcluir:function(){var d=this;b("body").append(this.vars.contentMsgExcluir);b(this.vars.idMsgExcluir).find(".modal-footer").find("button").eq(0).click(function(h){var g=d.getCheckbox_Checked();var f=new Object;f[d.vars.constCodigos]=new Object();g.each(function(e){f[d.vars.constCodigos][e]=b(this).parent().find("input:hidden").val()});b().ajaxLoad({type:"post",url:d.vars.urlExcluirRegistros,timeout:15000,data:f,message:"Excluido...",success:function(e){b.unblockUI();b(d.vars.idTabela).dataTable().fnDraw(true)},error:function(i,e){if(i.readyState==0||i.status==0){return}if(e=="timeout"){b().msgError("<strong>Por Favor, Tente Novamente!</strong>")}else{b(d.vars.idTooltipMessage).showMessageErr(i.responseText)}}})});b(this.vars.idMsgExcluir).draggable({cursor:"move"});b(this.vars.idMsgExcluir).modal({show:false});b(this.vars.idMsgExcluir).on("shown",function(){b(this).find(".modal-footer").find("button").eq(0).focus()});b(this.vars.idBtnExcluir).click(function(e){var f=d.getCheckbox_Checked();if(f.length==0){b().msgWarning("<strong>Nenhum registro selecionado!<strong>")}else{b(d.vars.idMsgExcluir).modal("show")}})},acaoConsultar:function(){var d=this;b(this.vars.idBtnConsulta).click(function(e){b(d.vars.idTabela).dataTable().fnDraw()})},prepararTabela:function(){var e=this;b(e.vars.idTabela).dataTable({sPaginationType:"bootstrap",bScrollCollapse:true,bFilter:false,bProcessing:false,bServerSide:true,sAjaxSource:e.vars.urlBuscarRegistros,sAjaxDataProp:"rows",iDisplayLength:25,oLanguage:{sLengthMenu:'<select class="pagesize"><option value="10">10</option><option value="25">25</option><option value="35">35</option><option value="50">50</option></select>',sProcessing:"Carregando...",sInfo:"_START_ - _END_ de <b>(_TOTAL_)</b> registros",sEmptyTable:"Nenhum registro encontrado",sInfoEmpty:"0 registros",oPaginate:{sFirst:"<<",sLast:">>",sNext:">",sPrevious:"<"}},aoColumnDefs:[{bSortable:false,aTargets:[0]}],aoColumns:e.vars.aoColumns,fnRowCallback:function(h,g,f){b(e.vars.idLabelBusca).html(e.mostrarLabelBusca());h=e.popularTabela(g,h);return h},fnServerParams:function(g){var f=e.getOpcoesConsulta();for(var h=0;h<f.length;h++){g.push(f[h])}},fnServerData:function(g,f,i,h){h.jqXHR=b().ajaxLoad({url:g,data:f,success:function(j){b.unblockUI();i(j)},dataType:"json",cache:false,message:{message:"Carregando...",showOverlay:false},error:function(k,j){b.unblockUI();if(k.readyState==0||k.status==0){return}if(j=="timeout"){b().msgError("<strong>Por Favor, Tente Novamente!</strong>")}else{b(e.vars.idTooltipMessage).showMessageErr(k.responseText)}i({iTotalDisplayRecords:0,iTotalRecords:0,rows:[]})}})}});var d=function(){b(e.vars.idTabela).css({width:b(e.vars.idTabela).parent().width()});b(e.vars.idTabela).dataTable().fnAdjustColumnSizing(false)};b(window).resize(function(){clearTimeout(window.refresh_size);window.refresh_size=setTimeout(function(){d()},100)})},initialize:function(d){var e=this;b.extend(this.vars,d);if(this.alterarOpcoesConsulta!=null){b(this.vars.idOpcoesConsulta).change(this.alterarOpcoesConsulta)}this.prepararTabela();if(this.vars.idHeadCheckTable!=null){b(this.vars.idHeadCheckTable).click(function(f){if(this.checked){b("input[name="+e.vars.idTdCheckTable+"]:not(:checked)").each(function(){this.checked=true})}else{b("input[name="+e.vars.idTdCheckTable+"]").each(function(){this.checked=false})}})}this.acaoConsultar();this.acaoExcluir();this.onsubmit("form")}};return c});
define(["jquery","jquery.ajax_load","jquery.ui","jquery.msg","jquery.string","blockui","datatables","principal_list_dataTables","bootstrap"],function(){var a=function(){var b=this;this.cacheLastJson=null;$.fn.dataTable.pipeline=function(e){var c=$.extend({pages:5,url:""},e);var d=-1;var g=null;var f=null;return function(m,o,k){var n=false;var l=m.start;var j=m.length;var h=l+j;if(d<0||l<d||h>g){n=true}else{if(JSON.stringify(m.order)!==JSON.stringify(f.order)||JSON.stringify(m.columns)!==JSON.stringify(f.columns)||JSON.stringify(m.search)!==JSON.stringify(f.search)){n=true}}f=$.extend(true,{},m);if(n){if(l<d){l=l-(j*(c.pages-1));if(l<0){l=0}}d=l;g=l+(j*c.pages);m.start=l;m.length=j*c.pages;k.jqXHR=$().ajaxLoad({url:c.url,data:m,success:function(p){b.cacheLastJson=$.extend(true,{},p);if(d!=l){p.data.splice(0,l-d)}p.data.splice(j,p.data.length);$.unblockUI();o(p);b.updateSize()},dataType:"json",cache:false,message:{message:"Carregando...",showOverlay:false},error:function(q,p){$.unblockUI();if(q.readyState==0||q.status==0){return}if(p=="timeout"){$().msgError("<strong>Por Favor, Tente Novamente!</strong>")}else{$(b.vars.idTooltipMessage).showMessageErr(q.responseText)}}})}else{var i=$.extend(true,{},b.cacheLastJson);i.draw=m.draw;i.data.splice(0,l-d);i.data.splice(j,i.data.length);o(i);b.updateSize();$(".dataTables_scrollBody").animate({scrollTop:0},0)}}};this.vars={idBtnConsulta:null,idBtnExcluir:null,idBtnClearFilters:null,idTooltipMessage:null,idTabela:null,idHeadCheckTable:"tblHeadCheck",idMsgExcluir:"#msgExcluir",idTdCheckTable:"tblTdCheck",dataTables:{},identifier:null,constCodigos:"codigos",urlBuscarRegistros:null,urlExcluirRegistros:null,urlEditar:null,contentMsgExcluir:"<div class='modal fade' id='msgExcluir' tabindex='-1'role='dialog' aria-labelledby='msgExcluirLabel' aria-hidden='true' style='display:none'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button><h4 class='modal-title' id='msgExcluirLabel'> Mensagem de AdvertÃªncia </h4></div><div class='modal-body'>Remover registros selecionados?</div><div class='modal-footer'><button type='button' class='btn btn-primary' data-dismiss='modal'> Confirmar </button><button type='button' class='btn btn-default' data-dismiss='modal'> Cancelar </button></div></div></div></div>"};this.updateSize=function(){$(this.vars.idTabela).DataTable().columns.adjust();$(".dataTables_scrollBody").css("height",(document.documentElement.clientHeight-$(".dataTables_scrollBody").offset().top)+"px")}};a.prototype={generateCell:function(h,b,e,g,c){var f=this;var d=f.vars.urlEditar+"/"+e[f.vars.dataTables.identifier];d=f.formatarColunaClick(d,b).children().unwrap();$(h).html(d)},getCheckbox_Checked:function(){return $("input:checkbox:checked[name="+this.vars.idTdCheckTable+"]").parent()},getTdCheck:function(b){var e=this,c=$(document.createElement("td")),f=$(document.createElement("input")),d=$(document.createElement("input"));f.attr("type","hidden");f.val(b);d.attr("name",e.vars.idTdCheckTable);d.attr("type","checkbox");d.click(function(g){if(this.checked){if($("input[name="+e.vars.idTdCheckTable+"]:checked").length==$("input[name="+e.vars.idTdCheckTable+"]").length){$(e.vars.idHeadCheckTable).attr("checked",true)}}else{if($(e.vars.idHeadCheckTable).attr("checked")){$(e.vars.idHeadCheckTable).attr("checked",false)}}});c.append(f);c.append(d);return c},formatarColunaClick:function(d,c){var b=$(document.createElement("a")),e=$(document.createElement("td"));b.attr("href",d);b.html($().htmlentities(c));b.html(c);e.append(b);return e},acaoLimparFiltros:function(){var b=this;$(b.vars.idBtnClearFilters).click(function(){var c=$(b.vars.idTabela).DataTable();c.fnFilterClear(c.settings()[0])})},acaoExcluir:function(){var b=this;$("body").append(this.vars.contentMsgExcluir);$(this.vars.idMsgExcluir).find(".modal-footer").find("button").eq(0).click(function(f){var d=b.getCheckbox_Checked();var c=new Object;c[b.vars.constCodigos]=new Object();d.each(function(e){c[b.vars.constCodigos][e]=$(this).parent().find("input:hidden").val()});$().ajaxLoad({type:"post",url:b.vars.urlExcluirRegistros,timeout:15000,data:c,message:"Excluido...",success:function(e){$.each(c[b.vars.constCodigos],function(g,h){$.each(b.cacheLastJson.data,function(j,i){if(b.cacheLastJson.data.hasOwnProperty(j)){if(i.codigo==h){b.cacheLastJson.data.splice(j,1);b.cacheLastJson.recordsFiltered--;b.cacheLastJson.recordsTotal--}}})});$.unblockUI();$(b.vars.idTabela).DataTable().draw(true)},error:function(g,e){if(g.readyState==0||g.status==0){return}if(e=="timeout"){$().msgError("<strong>Por Favor, Tente Novamente!</strong>")}else{$(b.vars.idTooltipMessage).showMessageErr(g.responseText)}}})});$(this.vars.idMsgExcluir).draggable({cursor:"move"});$(this.vars.idMsgExcluir).modal({show:false});$(this.vars.idMsgExcluir).on("shown",function(){$(this).find(".modal-footer").find("button").eq(0).focus()});$(this.vars.idBtnExcluir).click(function(c){var d=b.getCheckbox_Checked();if(d.length==0){$().msgWarning("<strong>Nenhum registro selecionado!<strong>")}else{$(b.vars.idMsgExcluir).modal("show")}})},acaoConsultar:function(){var b=this;$(this.vars.idBtnConsulta).click(function(c){b.aplicarFiltros().draw()})},onsubmit:function(b){$(b).eq(0).submit(function(c){c.preventDefault()})},aplicarFiltros:function(){var b=$(this.vars.idTabela).DataTable();$(".dataTables_filter_column").each(function(){b.column($(this).parent().index()+":visible").search(this.value)});$(this.vars.idTabela).DataTable().search($(this.vars.idTabela+"_filter input[type=search]").val());return b},prepararTabela:function(){var e=this,c={orderCellsTop:true,scrollCollapse:true,scrollY:(document.documentElement.clientHeight-$(e.vars.idTabela).offset().top-50)+"px",searching:true,processing:false,serverSide:true,pageLength:25,stripeClasses:["",""],language:{lengthMenu:"_MENU_",processing:"Carregando...",info:"<h4><span class='label label-primary'>_START_-_END_ de <b>(_TOTAL_)</b> - _MAX_</span></h4>",infoFiltered:"",emptyTable:"Nenhum registro encontrado",zeroRecords:"Nenhum registro encontrado",infoEmpty:"<h4><span class='label label-default'>0 registros</span></h4>",search:"<div class='input-group'><span class='input-group-addon'><label>Por Todos:</label></span>_INPUT_<span class='input-group-btn'></span></div> ",paginate:{next:'<span class="glyphicon glyphicon-chevron-right"></span>',previous:'<span class="glyphicon glyphicon-chevron-left"></span>'}},ajax:$.fn.dataTable.pipeline({url:e.vars.urlBuscarRegistros}),order:[],columnDefs:[{data:null,title:'<input id="'+e.vars.idHeadCheckTable+'" type="checkbox"/>',searchable:false,orderable:false,aTargets:[0]}],initComplete:function(h,g){e.updateSize();this.fnSetFilteringPressEnter(h)}};$.extend(c,e.vars.dataTables);$(e.vars.idTabela).append("<thead><tr><th></th></tr><tr><th></th></tr></thead>");for(var b in c.columns){if(c.columns.hasOwnProperty(b)){if(!c.columns[b].hasOwnProperty("createdCell")){c.columns[b].createdCell=function(k,g,i,j,h){e.generateCell(k,g,i,j,h)}}var f=c.columns[b].title;var d='<input class="dataTables_filter_column form-control" type="text" placeholder="Buscar '+f+'" />';$(e.vars.idTabela+" thead tr:eq(1)").append("<th>"+d+"</th>");$(e.vars.idTabela+" thead tr:eq(0)").append("<th></th>")}}c.columns.unshift({data:null,createdCell:function(l,g,j,k,h){var i=e.getTdCheck(j[e.vars.dataTables.identifier]).children().unwrap();$(l).html(i)}});$(e.vars.idTabela).DataTable(c);$(e.vars.idBtnConsulta).appendTo(e.vars.idTabela+"_filter .input-group-btn");$(e.vars.idBtnConsulta).show();$(e.vars.idTabela+"_filter > label").addClass("col-xs-12");$(".dataTables_filter_column").on("keyup change",function(g){if(g.which===13){e.aplicarFiltros().draw()}})},initialize:function(b){var c=this;$.extend(this.vars,b);this.prepararTabela();if(this.vars.idHeadCheckTable!=null){$("#"+this.vars.idHeadCheckTable).click(function(d){if(this.checked){$("input[name="+c.vars.idTdCheckTable+"]:not(:checked)").each(function(){this.checked=true})}else{$("input[name="+c.vars.idTdCheckTable+"]").each(function(){this.checked=false})}})}this.acaoConsultar();this.acaoExcluir();this.acaoLimparFiltros();$(window).resize(function(){clearTimeout(window.refresh_size);window.refresh_size=setTimeout(function(){c.updateSize()},100)});$("body").css("overflow-y","hidden");$('button[class="close"][aria-hidden="true"][data-dismiss="alert"]').on("click",function(){$(window).resize()});this.onsubmit("form")}};return a});
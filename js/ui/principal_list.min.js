define(["jquery","jquery.ajax_load","jquery.ui","jquery.msg","blockui","datatables","principal_list_dataTables","bootstrap"],function(){var b=function a(){var c=this;this.oCache={iCacheLower:-1};function d(g,k,j){for(var h=0,f=g.length;h<f;h++){if(g[h].name==k){g[h].value=j}}}function e(g,j){for(var h=0,f=g.length;h<f;h++){if(g[h].name==j){return g[h].value}}return null}this.fnDataTablesPipeline=function(f,r,l,g){var o=5;var q=false;var p=e(r,"sEcho");var n=e(r,"iDisplayStart");var k=e(r,"iDisplayLength");var j=n+k;c.oCache.iDisplayStart=n;if(c.oCache.iCacheLower<0||n<c.oCache.iCacheLower||j>c.oCache.iCacheUpper){q=true}if(c.oCache.lastRequest&&!q){for(var m=0,h=r.length;m<h;m++){if(r[m].name!="iDisplayStart"&&r[m].name!="iDisplayLength"&&r[m].name!="sEcho"){if(r[m].value!=c.oCache.lastRequest[m].value){q=true;break}}}}c.oCache.lastRequest=r.slice();if(q){if(n<c.oCache.iCacheLower){n=n-(k*(o-1));if(n<0){n=0}}c.oCache.iCacheLower=n;c.oCache.iCacheUpper=n+(k*o);c.oCache.iDisplayLength=e(r,"iDisplayLength");d(r,"iDisplayStart",n);d(r,"iDisplayLength",k*o);g.jqXHR=$().ajaxLoad({url:f,data:r,success:function(i){c.oCache.lastJson=$.extend(true,{},i);if(c.oCache.iCacheLower!=c.oCache.iDisplayStart){i.rows.splice(0,c.oCache.iDisplayStart-c.oCache.iCacheLower)}i.rows.splice(c.oCache.iDisplayLength,i.rows.length);$.unblockUI();l(i);$(c.vars.idTabela).dataTable().fnAdjustColumnSizing(false);$(".dataTables_scrollBody").css("height",(document.documentElement.clientHeight-$(c.vars.idTabela+"_wrapper").offset().top-43-$(c.vars.idTabela+"_wrapper .row").height())+"px")},dataType:"json",cache:false,message:{message:"Carregando...",showOverlay:false},error:function(t,i){$.unblockUI();if(t.readyState==0||t.status==0){return}if(i=="timeout"){$().msgError("<strong>Por Favor, Tente Novamente!</strong>")}else{$(c.vars.idTooltipMessage).showMessageErr(t.responseText)}}})}else{var s=$.extend(true,{},c.oCache.lastJson);s.sEcho=p;s.rows.splice(0,n-c.oCache.iCacheLower);s.rows.splice(k,s.rows.length);l(s);$(c.vars.idTabela).dataTable().fnAdjustColumnSizing(false);$(".dataTables_scrollBody").css("height",(document.documentElement.clientHeight-$(c.vars.idTabela+"_wrapper").offset().top-43-$(c.vars.idTabela+"_wrapper .row").height())+"px");$(".dataTables_scrollBody").animate({scrollTop:0},0)}return};this.vars={idBtnConsulta:null,idBtnExcluir:null,idTooltipMessage:null,idTabela:null,idOpcoesConsulta:null,idHeadCheckTable:null,aoColumns:[],idMsgExcluir:"#msgExcluir",idTdCheckTable:"tblTdCheck",constCodigos:"codigos",urlBuscarRegistros:null,urlExcluirRegistros:null,contentMsgExcluir:"<div class='modal fade' id='msgExcluir' tabindex='-1'role='dialog' aria-labelledby='msgExcluirLabel' aria-hidden='true' style='display:none'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button><h4 class='modal-title' id='msgExcluirLabel'> Mensagem de AdvertÃªncia </h4></div><div class='modal-body'>Remover registros selecionados?</div><div class='modal-footer'><button type='button' class='btn btn-primary' data-dismiss='modal'> Confirmar </button><button type='button' class='btn btn-default' data-dismiss='modal'> Cancelar </button></div></div></div></div>"};this.alterarOpcoesConsulta=null;this.getOpcoesConsulta=null;this.onsubmit=function(f){$(f).eq(0).submit(function(g){$(c.vars.idTabela).dataTable().fnDraw();g.preventDefault()})}};b.prototype={popularTabela:null,getCheckbox_Checked:function(){return $("input:checkbox:checked[name="+this.vars.idTdCheckTable+"]").parent()},getTdCheck:function(c){var f=this,d=$(document.createElement("td")),g=$(document.createElement("input")),e=$(document.createElement("input"));g.attr("type","hidden");g.val(c);e.attr("name",f.vars.idTdCheckTable);e.attr("type","checkbox");e.click(function(h){if(this.checked){if($("input[name="+f.vars.idTdCheckTable+"]:checked").length==$("input[name="+f.vars.idTdCheckTable+"]").length){$(f.vars.idHeadCheckTable).attr("checked",true)}}else{if($(f.vars.idHeadCheckTable).attr("checked")){$(f.vars.idHeadCheckTable).attr("checked",false)}}});d.append(g);d.append(e);return d},formatarColunaClick:function(e,d){var c=$(document.createElement("a")),f=$(document.createElement("td"));c.attr("href",e);c.html($().htmlentities(d));c.html(d);f.append(c);return f},acaoExcluir:function(){var c=this;$("body").append(this.vars.contentMsgExcluir);$(this.vars.idMsgExcluir).find(".modal-footer").find("button").eq(0).click(function(g){var f=c.getCheckbox_Checked();var d=new Object;d[c.vars.constCodigos]=new Object();f.each(function(e){d[c.vars.constCodigos][e]=$(this).parent().find("input:hidden").val()});$().ajaxLoad({type:"post",url:c.vars.urlExcluirRegistros,timeout:15000,data:d,message:"Excluido...",success:function(e){$.each(d[c.vars.constCodigos],function(h,j){$.each(c.oCache.lastJson.rows,function(k,i){if(c.oCache.lastJson.rows.hasOwnProperty(k)){if(i.codigo==j){c.oCache.lastJson.rows.splice(k,1);c.oCache.lastJson.iTotalDisplayRecords--;c.oCache.lastJson.iTotalRecords--}}})});$.unblockUI();$(c.vars.idTabela).dataTable().fnDraw(true)},error:function(h,e){if(h.readyState==0||h.status==0){return}if(e=="timeout"){$().msgError("<strong>Por Favor, Tente Novamente!</strong>")}else{$(c.vars.idTooltipMessage).showMessageErr(h.responseText)}}})});$(this.vars.idMsgExcluir).draggable({cursor:"move"});$(this.vars.idMsgExcluir).modal({show:false});$(this.vars.idMsgExcluir).on("shown",function(){$(this).find(".modal-footer").find("button").eq(0).focus()});$(this.vars.idBtnExcluir).click(function(d){var e=c.getCheckbox_Checked();if(e.length==0){$().msgWarning("<strong>Nenhum registro selecionado!<strong>")}else{$(c.vars.idMsgExcluir).modal("show")}})},acaoConsultar:function(){var c=this;$(this.vars.idBtnConsulta).click(function(d){$(c.vars.idTabela).dataTable().fnDraw()})},prepararTabela:function(){var d=this;$(d.vars.idTabela).dataTable({sPaginationType:"bootstrap",bScrollCollapse:true,sScrollY:(document.documentElement.clientHeight-$("#tabela").offset().top-50)+"px",bFilter:false,bProcessing:false,bServerSide:true,sAjaxSource:d.vars.urlBuscarRegistros,sAjaxDataProp:"rows",iDisplayLength:25,asStripeClasses:["",""],oLanguage:{sLengthMenu:'<select class="pagesize form-control"><option value="10">10</option><option value="25">25</option><option value="35">35</option><option value="50">50</option></select>',sProcessing:"Carregando...",sInfo:"<h4><span class='label label-primary'>_START_-_END_ de <b>(_TOTAL_)</b></span></h4>",sEmptyTable:"Nenhum registro encontrado",sInfoEmpty:"<h4><span class='label label-default'>0 registros</span></h4>",oPaginate:{sNext:'<span class="glyphicon glyphicon-chevron-right"></span>',sPrevious:'<span class="glyphicon glyphicon-chevron-left"></span>'}},aoColumnDefs:[{bSortable:false,aTargets:[0]}],aoColumns:d.vars.aoColumns,fnRowCallback:function(g,f,e){g=d.popularTabela(f,g);return g},fnServerParams:function(f){var e=d.getOpcoesConsulta();for(var g=0;g<e.length;g++){f.push(e[g])}},fnInitComplete:function(f,e){$(d.vars.idTabela).dataTable().fnAdjustColumnSizing(false);$(".dataTables_scrollBody").css("height",(document.documentElement.clientHeight-$(d.vars.idTabela+"_wrapper").offset().top-43-$(d.vars.idTabela+"_wrapper .row").height())+"px")},fnServerData:d.fnDataTablesPipeline});$("body").css("overflow-y","hidden");$(".panel-search").html($('[id="panel-search.html"]').html());$('[id="panel-search.html"]').remove();var c=function(){$(d.vars.idTabela).dataTable().fnAdjustColumnSizing(false);$(".dataTables_scrollBody").css("height",(document.documentElement.clientHeight-$(d.vars.idTabela+"_wrapper").offset().top-43-$(d.vars.idTabela+"_wrapper .row").height())+"px")};$(window).resize(function(){clearTimeout(window.refresh_size);window.refresh_size=setTimeout(function(){c()},100)});$('button[class="close"][aria-hidden="true"][data-dismiss="alert"]').on("click",function(){$(window).resize()})},initialize:function(c){var d=this;$.extend(this.vars,c);this.prepararTabela();if(this.vars.idHeadCheckTable!=null){$(this.vars.idHeadCheckTable).click(function(f){if(this.checked){$("input[name="+d.vars.idTdCheckTable+"]:not(:checked)").each(function(){this.checked=true})}else{$("input[name="+d.vars.idTdCheckTable+"]").each(function(){this.checked=false})}})}if(this.alterarOpcoesConsulta!=null){$(this.vars.idOpcoesConsulta).change(this.alterarOpcoesConsulta)}this.acaoConsultar();this.acaoExcluir();this.onsubmit("form")}};return b});